#coding:utf-8

'''

- Ajouter la détection par BOOLEAN BASED
- Ajouter des explications

+ La detection marche que si la cible 
  génere des erreurs ou un code HTTP 500

'''


from req_ import req
from re import search

def getConf(body, config):

	badChar = [
		'\'',
		'"'
	]

	comment = [
		'#',
		'-- -',
		'--+',
	]

	MySQL = [
		'You have an error in your SQL syntax',
		'Warning: mysql_fetch_array()',
		'Warning: mysqli_fetch_array()'
	]


	# Détection basée sur les messages d'erreurs

	for char in badChar:
		for com in comment:
			rep = req(body, char + com)# Injection des mauvais caractères

			for err in MySQL:
				if err in rep['body']:# On check si dans la réponse il y a des erreurs

					config['dbms'] = 'MySQL'
					config['escape'] = char
					config['comment'] = com
					config['detection'] = 'errorBased'

					return True
					break

	# Déction basée sur le code HTTP

	for char in badChar:
		for com in comment:
			rep = req(body, char + com)
			rep2 = req(body, char + char + com)

			if search(r'^2', rep['code']) and search(r'^5', rep2['code']):

				config['escape'] = char
				config['comment'] = com

				return True
				break

	for com in comment:
		rep = req(body, '' + com)# Comparaison pour integer context
		rep2 = req(body, '\'')
		print(rep['url'])
		print(rep2['url'])

		if search(r'^2', rep['code']) and search(r'^5', rep2['code']):

			config['comment'] = com
			config['detection'] = 'codeBased'

			return True	
		